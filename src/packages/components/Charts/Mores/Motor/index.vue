<template>
  <svg
    id="Layer_1"
    data-name="Layer 1"
    xmlns="http://www.w3.org/2000/svg"
    xmlns:xlink="http://www.w3.org/1999/xlink"
    viewBox="0 0 512 512"
  >
    <defs>
      <clipPath id="clippath">
        <path
          d="M242.27.37c4.55-.24,9.12-.37,13.73-.37,62.86,0,120.41,22.67,164.97,60.26l-71.02,103.11c-21.95-22.26-51.74-36.78-84.83-39.05L242.27.37ZM169.38,156.48c23.2-20.22,53.5-32.48,86.62-32.48.31,0,.61,0,.92.01L234.24.93c-66.85,5.63-126.38,36.93-168.7,84.03l103.84,71.52ZM124.32,246.89c2.27-33.1,16.79-62.88,39.05-84.83L60.26,91.03C22.67,135.59,0,193.14,0,256c0,4.61.13,9.18.37,13.73l123.95-22.84ZM355.52,169.38c20.22,23.2,32.48,53.5,32.48,86.62,0,.31,0,.61-.01.92l123.08-22.68c-5.63-66.85-36.93-126.38-84.03-168.7l-71.52,103.84ZM380,256c0,68.37-55.63,124-124,124s-124-55.63-124-124,55.63-124,124-124,124,55.63,124,124ZM228.79,155.52c.49,2.15,2.63,3.5,4.79,3.01,7.31-1.67,14.85-2.52,22.42-2.52,12.55,0,24.79,2.29,36.37,6.82.48.19.97.28,1.46.28,1.6,0,3.11-.97,3.73-2.55.8-2.06-.21-4.38-2.27-5.18-12.52-4.89-25.73-7.37-39.29-7.37-8.17,0-16.31.92-24.21,2.72-2.15.49-3.5,2.64-3.01,4.79ZM165.92,299.48c-6.58-13.61-9.92-28.24-9.92-43.48,0-4.96.37-9.93,1.09-14.79.32-2.19-1.18-4.22-3.37-4.54-2.19-.33-4.22,1.18-4.54,3.37-.78,5.25-1.17,10.62-1.17,15.97,0,16.46,3.61,32.26,10.72,46.96.69,1.43,2.12,2.26,3.6,2.26.58,0,1.18-.13,1.74-.4,1.99-.96,2.82-3.35,1.86-5.34ZM205.86,169.46c1.91-1.11,2.56-3.56,1.45-5.47-1.11-1.91-3.56-2.56-5.47-1.45-18.85,10.95-33.8,27.1-43.24,46.72-.96,1.99-.12,4.38,1.87,5.34.56.27,1.15.4,1.73.4,1.49,0,2.92-.84,3.61-2.27,8.74-18.17,22.58-33.13,40.04-43.27ZM233.8,353.53c-19.62-4.45-37.27-14.63-51.05-29.45-1.5-1.62-4.04-1.71-5.65-.21-1.62,1.5-1.71,4.04-.21,5.65,14.88,16,33.95,27,55.14,31.8.3.07.6.1.89.1,1.83,0,3.48-1.26,3.9-3.12.49-2.15-.86-4.3-3.02-4.79ZM256,324c37.5,0,68-30.5,68-68s-30.5-68-68-68-68,30.5-68,68,30.5,68,68,68ZM324,334.8c-1.38-1.72-3.89-2.01-5.62-.63-15.77,12.6-34.74,20.06-54.84,21.55-2.2.16-3.86,2.08-3.69,4.29.16,2.1,1.91,3.7,3.99,3.7.1,0,.2,0,.3-.01,21.72-1.62,42.2-9.67,59.24-23.28,1.73-1.38,2.01-3.9.63-5.62ZM360,251.77c-2.21,0-4,1.79-4,4v.23c0,20.21-6,39.69-17.35,56.31-1.25,1.83-.78,4.31,1.05,5.56.69.47,1.48.7,2.25.7,1.28,0,2.53-.61,3.31-1.74,12.26-17.96,18.74-38.99,18.74-60.83v-.23c0-2.21-1.79-4-4-4ZM359.16,223.95c-6.44-20.75-18.88-38.91-35.98-52.52-1.73-1.38-4.25-1.09-5.62.64-1.38,1.73-1.09,4.25.64,5.62,15.84,12.6,27.36,29.41,33.32,48.63.53,1.72,2.11,2.82,3.82,2.82.39,0,.79-.06,1.19-.18,2.11-.65,3.29-2.9,2.63-5.01ZM387.68,265.11c-2.27,33.1-16.79,62.88-39.05,84.83l103.11,71.02c37.59-44.56,60.26-102.11,60.26-164.97,0-4.61-.13-9.18-.37-13.73l-123.95,22.84ZM156.48,342.62c-20.22-23.2-32.48-53.5-32.48-86.62,0-.31,0-.61.01-.92L.93,277.76c5.63,66.85,36.93,126.38,84.03,168.7l71.52-103.84ZM342.62,355.52c-23.2,20.22-53.5,32.48-86.62,32.48-.31,0-.61,0-.92-.01l22.68,123.08c66.85-5.63,126.38-36.93,168.7-84.03l-103.84-71.52ZM246.89,387.68c-33.1-2.27-62.88-16.79-84.83-39.05l-71.02,103.11c44.56,37.59,102.11,60.26,164.97,60.26,4.61,0,9.18-.13,13.73-.37l-22.84-123.95Z"
          style="fill: none; stroke-width: 0px"
        />
        <animateTransform v-if="open"
          attributeName="transform"
          repeatCount="indefinite"
          type="rotate"
          from="0 256 256"
          to="360 256 256"
          dur="6"
        ></animateTransform>
      </clipPath>
      <linearGradient
        id="linear-gradient"
        x1="430.22"
        y1="-45.75"
        x2="81.78"
        y2="557.75"
        gradientUnits="userSpaceOnUse"
      >
        <stop offset="0" stop-color="#eee" />
        <stop offset="1" stop-color="#777" />
      </linearGradient>
      <linearGradient
        id="linear-gradient-2"
        x1="318.01"
        y1="148.59"
        x2="193.99"
        y2="363.41"
        gradientUnits="userSpaceOnUse"
      >
        <stop offset="0" stop-color="#444" />
        <stop offset="1" stop-color="#777" />
      </linearGradient>
    </defs>
    <g style="clip-path: url(#clippath)">
      <rect
        x=".93"
        y=".93"
        width="510.14"
        height="510.14"
        style="fill: url(#linear-gradient); stroke-width: 0px"
      />
      <circle cx="256" cy="256" r="124" style="fill: url(#linear-gradient-2); stroke-width: 0px" />
    </g>
  </svg>
</template>

<script setup lang="ts">
import { PropType, ref, watch } from 'vue'
import { CreateComponentType } from '../../../../../packages/index.d'
import { useChartDataFetch } from '../../../../../hooks/useChartDataFetch.hook'
import { useChartEditStore } from '../../../../../store/modules/chartEditStore/chartEditStore'
import { OptionType } from './config'

const props = defineProps({
  chartConfig: {
    type: Object as PropType<CreateComponentType>,
    required: true
  }
})

const open = ref(false)

const updateDatasetHandler = (newVal: string | number) => {
  console.log(newVal)
  if (typeof newVal === 'string') {
    open.value = false
  } else if (typeof newVal === 'number') {
    if (newVal > 10) {
        open.value = true
    } else {
        open.value = false
    }
    
  }
}

watch(
  () => props.chartConfig.option,
  newVal => {
    try {
      updateDatasetHandler((newVal as any as OptionType).dataset)
    } catch (error) {
      console.log(error)
    }
  },
  {
    immediate: true,
    deep: true
  }
)


useChartDataFetch(props.chartConfig, useChartEditStore, (newVal: string | number) => {
  // @ts-ignore
  updateDatasetHandler(newVal)
})
</script>

<style lang="scss" scoped>
svg {
  display: block;
  width: 100%;
  height: 100%;
  cursor: pointer;
}
</style>
